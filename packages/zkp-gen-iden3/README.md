# @rarimo/zkp-gen-iden3
These packages aim to provide developers with a set of commonly used functions and features for building web applications, such as handling big numbers, date manipulation, subscribing to and receiving notifications when certain events occur with EventEmitter, and more.

![version (scoped package)](https://badgen.net/npm/v/@rarimo/zkp-gen-iden3)
![types](https://badgen.net/npm/types/@rarimo/zkp-gen-iden3)
![tree-shaking](https://badgen.net/bundlephobia/tree-shaking/@rarimo/zkp-gen-iden3)
![checks](https://badgen.net/github/checks/rarimo/js-sdk/main)

## Getting Started

### Installing

```
yarn add @rarimo/zkp-gen-iden3
```

### Usage

```ts
import { ZkpGen } from '@rarimo/zkp-gen-iden3'

/**
 * define type with variable to proof,
 * verifiableCredentials response will keep this variable in credentialSubject
 */
type QueryVariableName = { isNatural: number }

const getZkProof = async () => {
  ZkpGen.setConfig({
    // rpc url where statev2 contract is deployed
    RPC_URL: 'https://matic-mumbai.chainstacklabs.com',
    // statev2 contract address
    STATE_V2_ADDRESS: '0x134B1BE34911E39A8397ec6289782989729807a4',
    // api url of issuer svc
    ISSUER_API_URL: 'http://127.0.0.1:8000/',
  })

  const zkProof = new ZkpGen<QueryVariableName>({
    /**
     * In zkp environment, every prove request should have a unique requestId
     * by using this requestId, issuer svc can identify the request
    */
    requestId: '1',
    /**
     * Identity generated by @rarimo/identity-gen-iden3
     */
    identity: identityStoreSnap.identity as Identity,
    /**
     * Verifiable credentials generated by @rarimo/auth-zkp-iden3
     */
    verifiableCredentials:
      verifiableCredentials as VerifiableCredentials<QueryVariableName>,

    /**
     * Challenge is a random string for example user metamask address without '0x'
     */
    challenge: String(provider?.address).substring(2),

    /**
     * Query is a json object with variable to proof
     */
    query: {
      /**
       * variableName is the name of variable to proof
       */
      variableName: 'isNatural',
      /**
       * operator is the operator to compare the variable with value
       */
      operator: ZKP_OPERATORS.EQUALS,
      /**
       * value is the value to compare with variable
       */
      value: ['1'],
    },
  })

  await zkProof.generateProof()

  setIsNaturalProof(zkProof)
}
```

### Important
Add this aliases to your client app build config
```ts
[
  { find: 'ethers', replacement: '../../node_modules/ethers/dist/ethers.esm.js' },
  { find: 'util', replacement: '../../node_modules/util/util.js' },
  { find: 'ejc', replacement: '../../node_modules/ejs/ejs.min.js' },
  { find: 'snarkjs', replacement: '../../node_modules/snarkjs/build/snarkjs.min.js' },
  { find: "@iden3/js-iden3-core", replacement: "../../node_modules/@iden3/js-iden3-core/dist/esm_esbuild/index.js" },
  { find: "@iden3/js-jwz", replacement: "../../node_modules/@iden3/js-jwz/dist/esm_esbuild/index.js" },
  { find: "@iden3/js-crypto", replacement: "../../node_modules/@iden3/js-crypto/dist/esm_esbuild/index.js" },
  { find: "@iden3/js-jsonld-merklization", replacement: "../../node_modules/@iden3/js-jsonld-merklization/dist/esm_esbuild/index.js" }
]
```

## Running the tests

```
yarn test
```

## License

This project is licensed under the MIT License - see the [LICENSE.md](../../LICENSE) file for details
